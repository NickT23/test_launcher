#!/usr/bin/env ruby

require "thor"
require "test_run/tests/minitest/finder"
require "test_run/tests/minitest/consolidator"
require "test_run/shell/runner"

class CLI < Thor

  desc "find", <<-DESC
    Find tests and run them. By trying to match an individual test or the name of a test file(s).
  DESC
  option :all, type: :boolean, desc: %{Run all tests found!}, default: false

  def find(input)
    if input == '--help'
      `test_runner --help find`
      exit
    end

    shell = TestRun::Shell::Runner.new(
      log_path: '/tmp/test_run.log',
      working_directory: '.',

    )

   find_results = TestRun::Tests::Minitest::Finder.find(input, shell, options)

   test_wrapper = TestRun::Tests::Minitest::Consolidator.consolidate(find_results, shell, options[:all])

   shell.exec test_wrapper.to_command
  end

  default_task :find
end

CLI.start(ARGV)
